---
import { Image } from 'astro:assets';
import logo from '../assets/01logo.png';

interface Props {}
---

<header
  id="site-header"
  class="fixed top-0 left-0 w-full z-50 transition-colors duration-300 data-[scrolled]:bg-deep/95 data-[scrolled]:backdrop-blur-sm data-[scrolled]:border-b data-[scrolled]:border-subtle"
  data-header
>
  <nav
    aria-label="メインナビゲーション"
    class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 lg:px-8"
  >
    <a href="/" class="shrink-0">
      <Image
        src={logo}
        alt="Latimeria ホーム"
        class="h-8 w-auto md:h-10"
      />
    </a>

    <ul class="hidden md:flex md:gap-6 lg:gap-8" role="list">
      <li>
        <a
          href="#about"
          class="text-sm lg:text-base text-body-secondary hover:text-link-hover transition-colors"
        >概要</a>
      </li>
      <li>
        <a
          href="#services"
          class="text-sm lg:text-base text-body-secondary hover:text-link-hover transition-colors"
        >サービス</a>
      </li>
      <li>
        <a
          href="#works"
          class="text-sm lg:text-base text-body-secondary hover:text-link-hover transition-colors"
        >実績</a>
      </li>
      <li>
        <a
          href="#news"
          class="text-sm lg:text-base text-body-secondary hover:text-link-hover transition-colors"
        >お知らせ</a>
      </li>
      <li>
        <a
          href="#contact"
          class="text-sm lg:text-base text-body-secondary hover:text-link-hover transition-colors"
        >お問い合わせ</a>
      </li>
    </ul>

    <button
      type="button"
      class="md:hidden p-2 text-body-secondary hover:text-link-hover transition-colors"
      aria-expanded="false"
      aria-controls="mobile-menu"
      aria-label="メニューを開く"
      data-menu-toggle
    >
      <svg
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
          data-hamburger-icon
        />
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
          class="hidden"
          data-close-icon
        />
      </svg>
    </button>
  </nav>

  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-subtle bg-deep/95 backdrop-blur-sm"
    data-mobile-menu
  >
    <ul class="flex flex-col px-4 py-2" role="list">
      <li>
        <a
          href="#about"
          class="block py-3 text-body-secondary hover:text-link-hover transition-colors"
        >概要</a>
      </li>
      <li>
        <a
          href="#services"
          class="block py-3 text-body-secondary hover:text-link-hover transition-colors"
        >サービス</a>
      </li>
      <li>
        <a
          href="#works"
          class="block py-3 text-body-secondary hover:text-link-hover transition-colors"
        >実績</a>
      </li>
      <li>
        <a
          href="#news"
          class="block py-3 text-body-secondary hover:text-link-hover transition-colors"
        >お知らせ</a>
      </li>
      <li>
        <a
          href="#contact"
          class="block py-3 text-body-secondary hover:text-link-hover transition-colors"
        >お問い合わせ</a>
      </li>
    </ul>
  </div>
</header>

<script>
  const header = document.querySelector<HTMLElement>('[data-header]');
  const heroSection = document.querySelector<HTMLElement>('#hero');

  if (header && heroSection) {
    const observer = new IntersectionObserver(
      ([entry]) => {
        header.toggleAttribute('data-scrolled', !entry.isIntersecting);
      },
      { threshold: 0 }
    );
    observer.observe(heroSection);
  }

  const toggle = document.querySelector<HTMLButtonElement>('[data-menu-toggle]');
  const menu = document.querySelector<HTMLElement>('[data-mobile-menu]');
  const hamburgerIcon = document.querySelector<SVGPathElement>('[data-hamburger-icon]');
  const closeIcon = document.querySelector<SVGPathElement>('[data-close-icon]');

  function openMenu() {
    if (!toggle || !menu || !hamburgerIcon || !closeIcon) return;
    toggle.setAttribute('aria-expanded', 'true');
    toggle.setAttribute('aria-label', 'メニューを閉じる');
    menu.classList.remove('hidden');
    hamburgerIcon.classList.add('hidden');
    closeIcon.classList.remove('hidden');
  }

  function closeMenu() {
    if (!toggle || !menu || !hamburgerIcon || !closeIcon) return;
    toggle.setAttribute('aria-expanded', 'false');
    toggle.setAttribute('aria-label', 'メニューを開く');
    menu.classList.add('hidden');
    hamburgerIcon.classList.remove('hidden');
    closeIcon.classList.add('hidden');
  }

  toggle?.addEventListener('click', () => {
    const isOpen = toggle.getAttribute('aria-expanded') === 'true';
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && toggle?.getAttribute('aria-expanded') === 'true') {
      closeMenu();
      toggle.focus();
    }
  });

  menu?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      closeMenu();
    });
  });
</script>
